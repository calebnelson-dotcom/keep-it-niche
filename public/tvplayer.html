<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <title>S0LACE â€¢ TV Player</title>
  <link rel="stylesheet" href="index.css">
  <style>
    body { overflow: hidden; display: flex; flex-direction: row; }
    .player-container { display: flex; width: 100vw; height: 100vh; background: #000; }
    #frame { flex: 1; border: none; background: #000; }
    
    .tv-sidebar { 
      width: 280px; 
      background: rgba(8, 8, 8, 0.9); 
      backdrop-filter: blur(10px);
      border-left: 2px solid var(--border-hard);
      padding: 20px;
      display: flex;
      flex-direction: column;
      gap: 15px;
      overflow-y: auto;
    }
    .ep-list { display: flex; flex-direction: column; gap: 8px; }
    .ep-btn {
      background: var(--panel-alt);
      border: 1px solid var(--border-hard);
      color: var(--fg-dim);
      padding: 10px;
      font-family: "Press Start 2P";
      font-size: 8px;
      text-align: left;
      cursor: pointer;
      border-radius: 8px;
    }
    .ep-btn.active { border-color: var(--accent); color: var(--accent); background: var(--accent-soft); }
  </style>
</head>
<body>

<div class="player-container">
  <iframe id="frame" allowfullscreen></iframe>
  
  <div class="tv-sidebar">
    <div style="font-size: 10px; color: var(--accent);" id="show-title">LOADING...</div>
    <select id="season-select" class="account-input" style="font-size: 8px;"></select>
    <div class="ep-list" id="episode-list"></div>
  </div>
</div>

<script>
  const TMDB_KEY = "2d1351cf74f73892042699d0431b799a";
  const params = new URLSearchParams(window.location.search);
  const id = params.get("id");
  const source = localStorage.getItem("s0laceMediaSource") || "vidfast";

  async function init() {
    const res = await fetch(`https://api.themoviedb.org/3/tv/${id}?api_key=${TMDB_KEY}`);
    const data = await res.json();
    document.getElementById("show-title").textContent = data.name.toUpperCase();

    const select = document.getElementById("season-select");
    data.seasons.forEach(s => {
      if(s.season_number === 0) return;
      let opt = document.createElement("option");
      opt.value = s.season_number;
      opt.textContent = "SEASON " + s.season_number;
      select.appendChild(opt);
    });

    select.onchange = () => loadEpisodes(select.value);
    loadEpisodes(1);
  }

  async function loadEpisodes(season) {
    const res = await fetch(`https://api.themoviedb.org/3/tv/${id}/season/${season}?api_key=${TMDB_KEY}`);
    const data = await res.json();
    const list = document.getElementById("episode-list");
    list.innerHTML = "";

    data.episodes.forEach(ep => {
      let btn = document.createElement("button");
      btn.className = "ep-btn";
      btn.textContent = ep.episode_number + ". " + ep.name.toUpperCase();
      btn.onclick = () => {
        document.querySelectorAll(".ep-btn").forEach(b => b.classList.remove("active"));
        btn.classList.add("active");
        play(season, ep.episode_number);
      };
      list.appendChild(btn);
    });
  }

  function play(s, e) {
    let finalUrl = "";
    if (source === "vidfast") {
      // Explicit Vidfast TV path
      finalUrl = `https://vidfast.pro/tv/${id}/${s}/${e}`;
    } else {
      finalUrl = `https://cinemaos.tech/player/${id}/${s}/${e}`;
    }
    // Using your existing Scramjet proxy path
    document.getElementById("frame").src = "/scramjet/" + finalUrl;
  }

  init();
</script>
</body>
</html>
