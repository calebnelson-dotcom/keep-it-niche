<!doctype html>
<html>
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>S0LACE • Media</title>
  <link rel="stylesheet" href="index.css"/>
</head>

<body>
<header class="site-header">
  <div class="site-title">S0LACE</div>
  <nav class="site-nav">
    <a href="index.html">Home</a>
    <a href="games.html">Games</a>
    <a href="media.html" class="active">Media</a>
    <a href="apps.html">Apps</a>
    <a href="settings.html">Settings</a>
  </nav>
</header>

<main>
  <div class="page-header">
    <h1>Media</h1>
    <div class="sub">Auto-search 1M+ movies using TMDB.</div>
  </div>

  <div class="games-search-wrap">
    <span class="search-label">SEARCH &gt;</span>
    <input id="tmdb-search" type="text" placeholder="Search TMDB…"/>
  </div>

  <div id="tmdb-status" style="font-size:9px;color:#7f7f7f;">Loading…</div>

  <div class="media-grid" id="media-grid"></div>
  <div id="media-empty">No movies found.</div>
</main>

<script>
const IMG_BASE = "https://image.tmdb.org/t/p/w342";
const grid = document.getElementById("media-grid");
const empty = document.getElementById("media-empty");
const statusBox = document.getElementById("tmdb-status");
const searchBox = document.getElementById("tmdb-search");

function createCard(movie) {
  const id = movie.id;
  const title = movie.title || "No Title";
  const poster = movie.poster_path ? IMG_BASE + movie.poster_path : "thumbs/placeholder.png";

  const a = document.createElement("a");
  a.className = "media-card";
  a.href = "#";

  a.innerHTML = `
    <div class="poster-thumb">
      <img src="${poster}" alt="${title}">
      <div class="media-overlay">${title}</div>
    </div>
  `;

  a.addEventListener("click", (e) => {
    e.preventDefault();
    window.location.href =
      "mediaplayer.html?src=" +
      encodeURIComponent("/scramjet/https://vidfast.pro/embed/movie/" + id) +
      "&title=" + encodeURIComponent(title);
  });

  return a;
}

async function loadTrending() {
  grid.innerHTML = "";
  statusBox.textContent = "Loading trending…";

  const res = await fetch("/tmdb?path=/trending/movie/day");
  const data = await res.json();

  (data.results || []).forEach(movie => grid.appendChild(createCard(movie)));

  empty.style.display = (data.results || []).length ? "none" : "block";
  statusBox.textContent = "Trending movies";
}

async function searchTMDB(q) {
  if (!q.trim()) return loadTrending();

  statusBox.textContent = "Searching TMDB…";

  const res = await fetch(`/tmdb?path=/search/movie&q=${encodeURIComponent(q)}`);
  const data = await res.json();

  grid.innerHTML = "";
  (data.results || []).forEach(movie => grid.appendChild(createCard(movie)));

  empty.style.display = (data.results || []).length ? "none" : "block";
  statusBox.textContent = "Search results";
}

document.addEventListener("DOMContentLoaded", () => {
  loadTrending();
  searchBox.addEventListener("input", () => searchTMDB(searchBox.value));
});
</script>

</body>
</html>
